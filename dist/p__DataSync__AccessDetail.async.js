(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[15],{"5ExB":function(e,a,t){e.exports={missionDetailWrapper:"antd-pro-pages-data-sync-access-detail-missionDetailWrapper",loading:"antd-pro-pages-data-sync-access-detail-loading",missionStep:"antd-pro-pages-data-sync-access-detail-missionStep",detailTitle:"antd-pro-pages-data-sync-access-detail-detailTitle",detailSourceName:"antd-pro-pages-data-sync-access-detail-detailSourceName",detailSourceBtns:"antd-pro-pages-data-sync-access-detail-detailSourceBtns",detailBtns:"antd-pro-pages-data-sync-access-detail-detailBtns",destinationName:"antd-pro-pages-data-sync-access-detail-destinationName",salesExtra:"antd-pro-pages-data-sync-access-detail-salesExtra",currentDate:"antd-pro-pages-data-sync-access-detail-currentDate",detailItem:"antd-pro-pages-data-sync-access-detail-detailItem",tableContainer:"antd-pro-pages-data-sync-access-detail-tableContainer",detailLine:"antd-pro-pages-data-sync-access-detail-detailLine",detailTable:"antd-pro-pages-data-sync-access-detail-detailTable",detailTitleName:"antd-pro-pages-data-sync-access-detail-detailTitleName",contentLink:"antd-pro-pages-data-sync-access-detail-contentLink",extraImg:"antd-pro-pages-data-sync-access-detail-extraImg",pageHeaderContent:"antd-pro-pages-data-sync-access-detail-pageHeaderContent"}},IJuM:function(e,a,t){"use strict";t.r(a);t("QKdE");var n,s,i,r=t("2Vcd"),c=(t("1hTB"),t("KFXw")),l=(t("jDyY"),t("q6Oz")),o=(t("Q1Fi"),t("7NCv")),d=(t("Hq/V"),t("fAnr")),m=(t("VIk5"),t("X+Ft")),p=(t("avCb"),t("dbpm")),u=(t("5hX3"),t("wjJH")),g=t("43Yg"),h=t.n(g),f=t("/tCh"),y=t.n(f),D=t("scpF"),N=t.n(D),E=t("O/V9"),k=t.n(E),w=t("Tfcp"),v=t.n(w),S=t("8aBX"),C=t.n(S),T=(t("I4dy"),t("+qVy")),b=t("i9FB"),I=t.n(b),P=t("LneV"),O=t("5ExB"),M=t.n(O),A=t("qj9E"),L=t("+n12"),x=t("1Haz"),B=t("rC0w"),U=t("zHco"),F=t("2kcH"),V=T["a"].RangePicker,H=(n=Object(P["connect"])(function(e){var a=e.dataSyncNewMission,t=e.dataDistribution,n=e.loading;return{dataSyncNewMission:a,dataDistribution:t,fetchDetailLineDataStatus:n.effects["dataSyncNewMission/getDetailLineDataByIdAction"],fetchDataOriginDetailStatus:n.effects["dataSyncNewMission/fetchDataOriginDetailAction"]}}),n((i=function(e){function a(){var e;return h()(this,a),e=N()(this,k()(a).call(this)),e.fetchDataDetail=function(){var a=e.props.dispatch,t=A["a"].storage.getStorage("processorId");a({type:"dataSyncNewMission/fetchDataOriginDetailAction",uuid:t})},e.fetchDataOneMinute=function(){e.fetchLineData(),clearInterval(e.lineTimer);var a=v()(e);e.lineTimer=setInterval(function(){a.fetchLineData()},5e3)},e.fetchLineData=function(){var a=e.props,t=a.dispatch,n=a.dataDistribution,s=a.dataSyncNewMission,i=e.state.rangePickerValue,r=n.platformType,c=s.checkType,l=v()(e),o=A["a"].storage.getStorage("processorId"),d=A["a"].moment(i[0]).format("YYYY-MM-DD HH:mm:ss"),m=A["a"].moment(i[1]).format("YYYY-MM-DD HH:mm:ss"),p=(new Date).getTime(),u=A["a"].helper.dateFormat(p);e.setState({updateTime:u}),new Promise(function(e,a){t({type:"dataSyncNewMission/getDetailLineDataByIdAction",id:o,params:{startTime:d,endTime:m,type:"dataOrigin"===A["a"].storage.getStorage("HtmlType").modalType?"local"===c?"local":"remote":"local"===r?"local":"remote"},resolve:e,reject:a})}).then(function(e){"true"===e.result?l.setState({rateLineData:JSON.parse(e.data)}):A["a"].prompt.error(e.message)})},e.websocketRunning=function(a,t){var n=a.params.data.hasOwnProperty("taskId")?a.params.data["taskId"]:"";e.websocketConstructor=new A["a"].Socket({isStart:!0,domain:"ws://192.168.10.122:8080",opts:{path:"/datadist/websocket/20"}}),e.websocketConstructor.on("open",function(){t.websocketConstructor.send(n)}),e.websocketConstructor.on("message",function(e){e.hasOwnProperty("isTrusted")&&e.isTrusted&&"\u8fde\u63a5\u6210\u529f"!==e.data&&(A["a"].moment(e.data).valueOf()||t.setState({fakeData:JSON.parse(e.data)}))})},e.handleDifferentTask=function(a,t){var n=A["a"].storage.getStorage("processorId"),s=e.props.dispatch;new Promise(function(e,a){s({type:"dataSyncNewMission/"+("activate"===t?"activateSourceProcessorAction":"resume"===t?"resumeSourceProcessorAction":"pause"===t?"pauseSourceProcessorAction":"restart"===t?"restartSourceProcessorAction":"delete"===t?"deleteSourceProcessorAction":""),uuid:n,resolve:e,reject:a})}).then(function(a){"true"===a.result?(A["a"].prompt.success(a.data),e.fetchDataDetail()):A["a"].prompt.error(a.message)})},e.updateDetailInfo=function(){e.fetchDataDetail()},e.resetNode=function(a){var t=v()(e),n=A["a"].storage.getStorage("processorId"),s=e.props.dispatch;new Promise(function(e,t){s({type:"dataSyncNewMission/restartProcessorDetailTaskAction",uuid:n,taskId:a.id,resolve:e,reject:t})}).then(function(e){"true"===e.result?(A["a"].prompt.success(e.data),t.fetchDataDetail()):A["a"].prompt.error(e.message)})},e.pageChange=function(a){var t=v()(e);e.setState({currentPage:a.current},function(){t.fetchDataDetail()})},e.selectDate=function(a){e.setState({rangePickerValue:Object(L["d"])(a)},function(){e.fetchLineData()})},e.handleRangePickerChange=function(a){e.setState({rangePickerValue:a},function(){e.fetchLineData()})},e.isActive=function(a){var t=e.state,n=t.rangePickerValue,s=(t.rangePickerType,Object(L["d"])(a));return n[0]&&n[1]&&n[0].isSame(s[0],"day")&&n[1].isSame(s[1],"day")?M.a.currentDate:""},e.websocketConstructor=null,e.lineTimer=null,e.state={rangePickerValue:Object(L["d"])("30min"),rangePickerType:"30min",activeText:{btn:"\u7acb\u5373\u6fc0\u6d3b",context:"\u4efb\u52a1\u5df2\u8bbe\u7f6e\u5b8c\u6bd5\uff0c\u8bf7\u70b9\u51fb[\u7acb\u5373\u6fc0\u6d3b]\u5f00\u59cb\u4efb\u52a1"},rateLineData:[],infoData:{},stateAndRateData:{state:"UNSIGNED",rate:"--"},stateAndDetail:{state:[{state:"RUNNING",worker_id:"192.168.10.122:8083"},{id:0,state:"RUNNING",worker_id:"192.168.10.122:8083"}],allDetailData:[],detailTableData:[],logData:[]},activeState:!1,fakeData:{},updateTime:"---"},e}return C()(a,e),y()(a,[{key:"componentDidMount",value:function(){var e=this.props,a=(e.dispatch,e.location);this.updateDetailInfo(),this.fetchLineData();A["a"].storage.getStorage("taskId");a.hasOwnProperty("params")&&a.params.hasOwnProperty("data")}},{key:"componentWillUnmount",value:function(){var e=this;clearInterval(this.lineTimer),this.websocketConstructor&&(this.websocketConstructor.close(),this.websocketConstructor.unon("open"),this.websocketConstructor.unon("message"),this.websocketConstructor.on("close",function(a){e.websocketConstructor=null}))}},{key:"render",value:function(){var e=this,a=this.props,t=a.dataSyncNewMission,n=a.fetchDetailLineDataStatus,s=a.fetchDataOriginDetail,i=a.fetchDataOriginDetailStatus,g=t.dataOriginDetail,h=g.processor,f=g.status,y=g.statistics,D=g.logs,N=this.state,E=N.rateLineData,k=N.rangePickerValue,w=N.updateTime,v=[{title:"ID",dataIndex:"id"},{title:"\u72b6\u6001",dataIndex:"state"},{title:"\u8fd0\u884c\u8282\u70b9",dataIndex:"worker_id"},{title:"\u64cd\u4f5c",render:function(a,t){return I.a.createElement(b["Fragment"],null,I.a.createElement(u["a"],{type:"redo",title:"\u91cd\u542f",onClick:function(){return e.resetNode(t)}}))}}],S=[{title:"\u5e8f\u53f7",dataIndex:"key"},{title:"\u6570\u636e\u603b\u91cf",dataIndex:"totalCount"}];return I.a.createElement(U["a"],{title:"",wrapperClassName:M.a.missionDetailWrapper},s?I.a.createElement(p["a"],{size:"large",className:M.a.missionStep}):I.a.createElement("div",null,I.a.createElement(o["a"],{className:M.a.detailTitle+" "+M.a.destinationName},I.a.createElement(d["a"],{span:13},I.a.createElement("div",{className:M.a.detailSourceName,title:h.hasOwnProperty("name")?h.name:"---"},h.hasOwnProperty("name")?h.name:"---"),I.a.createElement("div",{className:M.a.detailSourceBtns},I.a.createElement(u["a"],{type:"exclamation-circle",style:{marginRight:20,fontSize:24,color:h.hasOwnProperty("state")?A["a"].lodash.isUndefined(B["e"][h.state])?B["e"]["UNKNOWN"].color:B["e"][h.state].color:B["e"]["UNKNOWN"].color},title:h.hasOwnProperty("state")?A["a"].lodash.isUndefined(B["e"][h.state])?B["e"]["UNKNOWN"].label:B["e"][h.state].label:B["e"]["UNKNOWN"].label}),I.a.createElement(m["a"],{disabled:h.state!==B["e"]["INACTIVED"].value&&h.state!==B["e"]["FAILED"].value,title:"\u6fc0\u6d3b",shape:"circle",icon:"bulb",size:"small",onClick:function(){return e.handleDifferentTask(h,"activate")}}),I.a.createElement(m["a"],{disabled:h.state!==B["e"]["PAUSED"].value,title:"\u5f00\u59cb",shape:"circle",icon:"caret-right",size:"small",onClick:function(){return e.handleDifferentTask(h,"resume")}}),I.a.createElement(m["a"],{disabled:h.state!==B["e"]["RUNNING"].value,title:"\u6682\u505c",shape:"circle",icon:"pause",size:"small",onClick:function(){return e.handleDifferentTask(h,"pause")}}),I.a.createElement(m["a"],{disabled:h.state!==B["e"]["RUNNING"].value&&h.state!==B["e"]["PAUSED"].value,title:"\u91cd\u542f",shape:"circle",icon:"reload",size:"small",onClick:function(){return e.handleDifferentTask(h,"restart")}}))),I.a.createElement(d["a"],{span:11,className:M.a.detailBtns,style:{textAlign:"right"}},I.a.createElement("span",null,"\u66f4\u65b0\u65f6\u95f4\uff1a"),I.a.createElement("span",null,w),I.a.createElement(m["a"],{type:"primary",onClick:this.updateDetailInfo,style:{marginLeft:10},loading:i},I.a.createElement("span",null,"\u5237\u65b0")))),I.a.createElement(l["a"],{className:M.a.detailLine,extra:I.a.createElement("div",{className:M.a.salesExtraWrap},I.a.createElement("div",{className:M.a.salesExtra},I.a.createElement("a",{className:this.isActive("30min"),onClick:function(){return e.selectDate("30min")}},I.a.createElement(x["FormattedMessage"],{id:"app.analysis.30min",defaultMessage:"30min"})),I.a.createElement("a",{className:this.isActive("1day"),onClick:function(){return e.selectDate("1day")}},I.a.createElement(x["FormattedMessage"],{id:"app.analysis.1day",defaultMessage:"1day"})),I.a.createElement("a",{className:this.isActive("3days"),onClick:function(){return e.selectDate("3days")}},I.a.createElement(x["FormattedMessage"],{id:"app.analysis.3days",defaultMessage:"3days"})),I.a.createElement("a",{className:this.isActive("7days"),onClick:function(){return e.selectDate("7days")}},I.a.createElement(x["FormattedMessage"],{id:"app.analysis.7days",defaultMessage:"7days"}))),I.a.createElement(V,{value:k,onChange:this.handleRangePickerChange,style:{width:340},showTime:!0}))},n?I.a.createElement(p["a"],null):I.a.createElement(F["a"],{rateLineData:E})),I.a.createElement(l["a"],{style:{marginBottom:20}},I.a.createElement(o["a"],{className:M.a.detailTitle},I.a.createElement(d["a"],{span:8},I.a.createElement("span",null,"\u63a5\u5165\u4eba\uff1a"),I.a.createElement("span",null,h.hasOwnProperty("createBy")?h.createBy:"---")),I.a.createElement(d["a"],{span:8,className:M.a.detailBtns},I.a.createElement("span",null,"\u521b\u5efa\u65f6\u95f4\uff1a"),I.a.createElement("span",null,h.hasOwnProperty("createDate")?A["a"].helper.dateFormat(h.createDate):"---"))),I.a.createElement(o["a"],{className:M.a.detailTitle},I.a.createElement(d["a"],{span:24},I.a.createElement("span",null,"\u63cf\u8ff0\uff1a"),I.a.createElement("span",null,h.hasOwnProperty("des")?h.des:"---")))),I.a.createElement("div",{className:M.a.detailItem},I.a.createElement("div",{className:M.a.detailTitleName},"\u8fd0\u884c\u72b6\u6001"),I.a.createElement("div",{className:M.a.tableContainer},I.a.createElement(c["a"],{className:M.a.detailTable,dataSource:f&&f.hasOwnProperty("tasks")?f.tasks:[],pagination:!1,columns:v,onChange:this.pageChange,loading:s}))),I.a.createElement("div",{className:M.a.detailItem},I.a.createElement("div",{className:M.a.detailTitleName},"\u6570\u636e\u7edf\u8ba1"),I.a.createElement("div",{className:M.a.tableContainer},I.a.createElement(o["a"],null,I.a.createElement(d["a"],{span:24},I.a.createElement("span",null,"\u7d2f\u8ba1\u6570\u636e\u603b\u91cf\uff1a"),I.a.createElement("span",null,y&&y.hasOwnProperty("totalCount")?y.totalCount:"---"))),I.a.createElement(c["a"],{className:M.a.detailTable,dataSource:y&&y.hasOwnProperty("statistics")?y.statistics:[],pagination:!1,columns:S,onChange:this.pageChange}))),I.a.createElement("div",{className:M.a.detailItem},I.a.createElement("div",{className:M.a.detailTitleName},"\u65e5\u5fd7\u4fe1\u606f"),I.a.createElement(l["a"],{style:{marginBottom:20}},I.a.createElement(o["a"],{className:M.a.detailTitle},I.a.createElement(d["a"],{span:24},I.a.createElement(r["a"],{loading:s,dataSource:D?D.length>10?A["a"].lodash.slice(D,0,9):D:[],renderItem:function(e,a){return I.a.createElement(r["a"].Item,{key:a},I.a.createElement("span",{style:{width:"100%",overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"},title:e},e))}})))))))}}]),a}(b["PureComponent"]),s=i))||s);a["default"]=H}}]);